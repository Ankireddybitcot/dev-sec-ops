# AWS Security - Recover or Rotate SSH Keys using SSM

  We will use [AWS SSM](https://www.youtube.com/watch?v=5JnOVMb4lTs) to recover a server for which there is no ssh key is attached or A server for which the SSH key is lost <sup>[Ref](#References)</sup>. We can use the similar technique to rotate the ssh keys for security reasons.

  ![Recover or Rotate SSH Keys using SSM](images/setup-ssh-key-recovery-using-userdata-valaxy-00.png)

  Follow this article in **[Youtube](https://www.youtube.com/c/ValaxyTechnologies)**

## Lab Setup

  You have couple of options to set this up in your account, You can use [AWS CDK](https://www.youtube.com/watch?v=MKwxpszw0Rc) or use the cloudformation template generated by CDK.

### Method 1: Using AWS CDK

  If you have AWS CDK installed you can close this repository and deploy the stack with 

  ```sh
  git clone git@github.com:miztiik/dev-sec-ops.git
  cd ./dev-sec-ops/rotate-recover-ec2-ssh-keys/
  source .env/bin/activate
  cdk deploy
  ```

### Method 2: Using AWS CDK

  If you are using cloudformation, the templates are under `cdk.out` directory the naming is usually `DIR_NAME.template.json`.
  _You can deploy them through GUI or console_ 

  ```sh
  aws cloudformation deploy \
        --template-file rotate-recover-ec2-ssh-keys.template.json \
        --stack-name "MiztiikStack" \
        --capabilities CAPABILITY_IAM
  ```

### Contact Us

You can reach out to us to get more details through [here](https://youtube.com/c/valaxytechnologies/about).

#### References

1. [Recover Lost Key Pair of AWS EC2 using Userdata](https://www.youtube.com/watch?v=Bqt538HRsws)
1. [Recover Key Pair of AWS EC2](https://www.youtube.com/watch?v=5btWXn4yWzQ)

### Metadata

**Level**: 100
